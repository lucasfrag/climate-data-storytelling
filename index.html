<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Climate Date Storytelling</title>
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css" rel="stylesheet">

    <link rel="stylesheet" href="./assets/css/leaflet.css" />
    <link rel="stylesheet" href="./assets/css/styles.css">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
    <!-- Hero Section -->
    <section class="hero-section d-flex align-items-center justify-content-center text-center vh-100"
        style="min-height: 100vh; width: 100%; padding: 0; background: linear-gradient(120deg, #1976d2 0%, #42a5f5 100%); color: #fff;">
        <div class="container h-100 d-flex flex-column justify-content-center">
            <div class="row justify-content-center align-items-center flex-grow-1">
                <div class="col-lg-10 col-md-12">
                    <h1 class="display-3 fw-bold mb-4" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.15);">
                        <i class="fas fa-globe-americas me-2"></i>
                        Climate Data Storytelling
                    </h1>
                    <p class="lead mb-5" style="font-size: 1.5rem;">
                        Descubra como o clima est√° mudando em Porto Alegre e no regi√£o sul do Brasil.<br>
                        Visualize dados meteorol√≥gicos, tend√™ncias e impactos de forma interativa e envolvente.
                    </p>


                    <a href="./artigo.html" class="btn btn-lg btn-outline-light px-5 py-3 mb-2">
                        <i class="fas fa-book-open me-2"></i> Ler o artigo completo
                    </a>
                    <a href="https://github.com/lucasfrag/climate-data-storytelling" target="_blank"
                        class="btn btn-lg btn-outline-light px-5 py-3 mb-2">
                        <i class="fab fa-github me-2"></i> Ver no GitHub
                    </a>


                    <div class="d-flex flex-column align-items-center mt-5">
                        <p class="mb-2" style="font-size: 1.15rem;">
                            <strong>Clique no bot√£o abaixo para come√ßar a explorar os dados.</strong>
                        </p>
                        <br><br>
                        <button id="explorarBtn"
                            class="btn btn-light rounded-circle shadow d-flex align-items-center justify-content-center animate-bounce"
                            style="width: 64px; height: 64px; font-size: 2rem; color: #1976d2;">
                            <i class="fas fa-arrow-down"></i>
                        </button>
                    </div>
                    <script>
                        document.getElementById('explorarBtn').addEventListener('click', function (e) {
                            e.preventDefault();
                            const target = document.querySelector('#porto-alegre');
                            if (target) {
                                target.scrollIntoView({ behavior: 'smooth' });
                            }
                        });                     
                    </script>
                </div>
            </div>
        </div>
    </section>

    <div class="tooltip" id="tooltip"></div>


    <!--------------------------------------------------------------------------------------------------------------------------->

    <!-- Se√ß√£o Porto Alegre -->
    <div class="container-fluid reveal-section vh-100 d-flex align-items-center justify-content-center "
        id="porto-alegre">
        <div class="row">

            <!-- Galeria de imagens -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center"
                style="background-color: #f8f9fa;">

                <div class="col-12 hv-100 d-flex flex-column justify-content-center align-items-center">
                    <h2 style="padding: 30px 0px 50px 0px; background-color: #f8f9fa;"></h2>
                    <div class="row">
                        <div class="col-lg-4 col-md-12 mb-4 mb-lg-0">
                            <img src="https://mdbcdn.b-cdn.net/img/Photos/Horizontal/Nature/4-col/img%20(73).webp"
                                class="w-100 shadow-1-strong rounded mb-4" alt="..." />

                            <img src="https://mdbcdn.b-cdn.net/img/Photos/Vertical/mountain1.webp"
                                class="w-100 shadow-1-strong rounded mb-4" alt="..." />
                        </div>

                        <div class="col-lg-4 mb-4 mb-lg-0">
                            <img src="https://mdbcdn.b-cdn.net/img/Photos/Vertical/mountain2.webp"
                                class="w-100 shadow-1-strong rounded mb-4" alt="..." />

                            <img src="https://mdbcdn.b-cdn.net/img/Photos/Horizontal/Nature/4-col/img%20(73).webp"
                                class="w-100 shadow-1-strong rounded mb-4" alt="..." />
                        </div>

                        <div class="col-lg-4 mb-4 mb-lg-0">
                            <img src="https://mdbcdn.b-cdn.net/img/Photos/Horizontal/Nature/4-col/img%20(18).webp"
                                class="w-100 shadow-1-strong rounded mb-4" alt="..." />

                            <img src="https://mdbcdn.b-cdn.net/img/Photos/Vertical/mountain3.webp"
                                class="w-100 shadow-1-strong rounded mb-4" alt="..." />
                        </div>
                    </div>
                </div>


            </div>


            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 " style="background-color: #f8f9fa; ">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light h1 mb-3 sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        Porto Alegre: A Capital Ga√∫cha
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">
                        <p>Porto Alegre √© a capital do estado do Rio Grande do Sul, localizada no extremo sul do Brasil.
                            Com cerca de 1,5 milh√£o de habitantes, √© um importante centro pol√≠tico, econ√¥mico e cultural
                            da regi√£o.</p>

                        <p>Situada √†s margens do Lago Gua√≠ba e cercada por morros, a cidade possui uma geografia que a
                            torna suscet√≠vel a alagamentos. Essa rela√ß√£o hist√≥rica com a √°gua molda tanto sua paisagem
                            quanto seus desafios.</p>

                        <p>Al√©m disso, Porto Alegre abriga algumas das esta√ß√µes meteorol√≥gicas mais antigas e completas
                            do estado, o que a torna um ponto estrat√©gico para entender como as mudan√ßas clim√°ticas
                            afetam o Sul do Brasil.</p>

                        <p>Escolhemos essa cidade porque ela sintetiza uma realidade comum a muitas outras: um ambiente
                            urbano pressionado por eventos clim√°ticos cada vez mais extremos.</p>

                        <p>Antes de entendermos as mudan√ßas no clima, √© fundamental conhecer as fontes dos dados.</p>

                        <hr>

                        <div class="end-content w-100 text-center mt-4">
                            <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                se√ß√£o.</small>
                            <button id="explorarEstacoes" class="btn btn-primary rounded-circle shadow"
                                style="width: 55px; height: 55px;" aria-label="Ir para a pr√≥xima se√ß√£o">
                                <span style="font-size: 1.7em; vertical-align: middle;"
                                    aria-hidden="true">&#8595;</span>
                            </button>

                            <script>
                                document.getElementById('explorarEstacoes').addEventListener('click', function (e) {
                                    e.preventDefault();
                                    const target = document.querySelector('#estacoes-meteorologicas');
                                    if (target) {
                                        target.scrollIntoView({ behavior: 'smooth' });
                                    }
                                });                                   
                            </script>
                        </div>

                    </div>
                </div>
            </div>


        </div>
    </div>


    <!---------------------------------------------------------------------------------------------------->

    <!-- Se√ß√£o Esta√ß√µes Meteorol√≥gicas -->
    <div class="container-fluid reveal-section vh-100 d-flex align-items-center justify-content-center "
        id="estacoes-meteorologicas">
        <div class="row">

            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 " style="background-color: #f8f9fa;">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light mb-3 text-h1 reveal-item sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        As Esta√ß√µes Meteorol√≥gicas
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">
                        <p class="reveal-item">Desde o ano 2000, as esta√ß√µes meteorol√≥gicas do INMET coletam dados
                            clim√°ticos. Com o tempo,
                            outras unidades, como a do Jardim Bot√¢nico e Bel√©m Novo, passaram a integrar essa rede,
                            permitindo an√°lises mais detalhadas e compara√ß√µes entre regi√µes da cidade.</p>

                        <section aria-labelledby="estacoes-title" class="reveal-item">





                            <div id="yearSliderContainer" class="my-3">
                                <label for="yearSlider" id="yearSliderLabel"
                                    class="form-label d-flex justify-content-between align-items-center">
                                    <strong>Ano:</strong>
                                    <span id="yearLabel">2020</span>

                                    <button id="playBtn" type="button" aria-label="Mostrar evolu√ß√£o das esta√ß√µes"
                                        title="Mostrar evolu√ß√£o das esta√ß√µes"
                                        class="btn btn-outline-primary btn-sm ms-3" aria-pressed="false"
                                        style="margin-left: 8px;">‚ñ∂Ô∏è Ver evolu√ß√£o</button>
                                </label>

                                <input style="width: 100%;" type="range" id="yearSlider" min="2000" max="2025"
                                    value="2000" aria-labelledby="yearSliderLabel" />


                                <div class="alert alert-info mt-4" role="alert">
                                    <strong>Dica:</strong> Clique no bot√£o <strong>"Ver evolu√ß√£o"</strong> ou
                                    <strong>deslize o controle
                                        abaixo</strong>.
                                </div>


                            </div>





                            <p class="mb-2 text-muted">O gr√°fico abaixo mostra a evolu√ß√£o do n√∫mero de esta√ß√µes
                                meteorol√≥gicas ao longo dos anos no estado do Rio Grande do Sul.
                                <br><br>Para visualizar as informa√ß√µes de um ano
                                espec√≠fico, basta passar o mouse sobre as barras.
                            </p>

                            <canvas height="80" id="graficoEstacoes" role="img"
                                aria-label="Gr√°fico de barras mostrando o n√∫mero de esta√ß√µes fundadas por ano"></canvas>

                            <hr>
                            <div class="end-content w-100 text-center">
                                <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                    se√ß√£o.</small>
                                <button id="explorarTransformacoes" class="btn btn-primary rounded-circle shadow"
                                    style="width: 55px; height: 55px;" aria-label="Ir para a pr√≥xima se√ß√£o">
                                    <span style="font-size: 1.7em; vertical-align: middle;"
                                        aria-hidden="true">&#8595;</span>
                                </button>
                                <br>


                                <script>
                                    document.getElementById('explorarTransformacoes').addEventListener('click', function (e) {
                                        e.preventDefault();
                                        const target = document.querySelector('#transformacoes');
                                        if (target) {
                                            target.scrollIntoView({ behavior: 'smooth' });
                                        }
                                    });                                   
                                </script>
                            </div>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos / Mapa -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center grafico-container"
                style="background-color: #f8f9fa;">
                <div id="map" class="vh-100" style="height: 600px;"></div>
            </div>
        </div>
    </div>
    </div>


    <!------------------------------------------------------------------------------------------------------------------------------->
    <!-- Se√ß√£o Transforma√ß√µes Clim√°ticas -->
    <div class="container-fluid reveal-section vh-100 d-flex align-items-center justify-content-center "
        id="transformacoes">
        <div class="row">

            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 scroll-content" style="background-color: #f8f9fa;">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light h1 mb-3 sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        Transforma√ß√µes Clim√°ticas na Cidade
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">


                        <p>Ao longo dos √∫ltimos anos, Porto Alegre passou por mudan√ßas clim√°ticas vis√≠veis nos dados.
                            As m√©dias mensais de temperatura indicam uma tend√™ncia de eleva√ß√£o, especialmente no ver√£o.
                            Os extremos ‚Äî dias excessivamente quentes ou frios ‚Äî tornaram-se mais frequentes.</p>

                        <p>Comparando os primeiros anos da s√©rie com os mais recentes, notamos mudan√ßas que, embora
                            sutis no curto prazo, revelam uma transforma√ß√£o progressiva. </p>

                        <p>No gr√°fico ao lado podemos ver:</p>

                        <p>
                            <strong>üî• Temperatura M√°xima:</strong> O dia mais quente
                            registrado em cada ano.
                        </p>
                        <p>
                            <strong>üå°Ô∏è Temperatura M√©dia:</strong> A m√©dia das temperaturas
                            mensais ao longo dos anos.
                        </p>
                        <p>
                            <strong>‚ùÑÔ∏è Temperatura M√≠nima:</strong> O dia mais frio registrado
                            em cada ano.
                        </p>




                        <div class="alert alert-info mt-4" role="alert">
                            <strong>Dica:</strong> Use o controle deslizante abaixo para selecionar um <strong>intervalo
                                de anos</strong>. O gr√°fico ser√° atualizado automaticamente de acordo com a sele√ß√£o.
                        </div>

                        <br>


                        <center>
                            <small>Selecione um intervalo de anos:</small>

                            <div style="width: 80%;">
                                <div id="range-anos"></div>
                                <div class="d-flex justify-content-between">
                                    <span id="range-inicio"></span>
                                    <span id="range-fim"></span>
                                </div>
                            </div>
                        </center>


                        <hr>
                        <div class="end-content w-100 text-center">
                            <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                se√ß√£o.</small>
                            <button class="btn btn-primary rounded-circle shadow" style="width: 55px; height: 55px;"
                                aria-label="Ir para a pr√≥xima se√ß√£o">
                                <span style="font-size: 1.7em; vertical-align: middle;"
                                    aria-hidden="true">&#8595;</span>
                            </button>
                        </div>

                        <script>
                            document.getElementById('explorarTransformacoes').addEventListener('click', function (e) {
                                e.preventDefault();
                                const target = document.querySelector('#transformacoes');
                                if (target) {
                                    target.scrollIntoView({ behavior: 'smooth' });
                                }
                            });                                   
                        </script>

                    </div>
                </div>
            </div>



            <!-- Gr√°fico -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center grafico-container"
                style="background-color: #f8f9fa;">


                <section id="transformacoes-climaticas" class="container my-5">
                    <div class="mb-4 p-4 rounded shadow-sm bg-white border" id="charts">
                        <h4>üìä Gr√°fico de Transforma√ß√µes Clim√°ticas</h4>
                        <hr>
                        <p class="text-muted mb-2 ">O gr√°fico abaixo mostra a evolu√ß√£o das temperaturas em Porto Alegre
                            entre 2000 e 2025.
                            <br><br>
                            Passe o mouse sobre os pontos para ver os valores e as datas dos
                            extremos.
                        </p>
                        <br>
                        <center>
                            <small class="text-muted">üí° Clique nas legendas para filtrar a visualiza√ß√£o:</small>
                        </center>

                        <canvas id="grafico-transformacoes" height="170"></canvas>
                    </div>
                </section>


                <!-- noUiSlider -->
                <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>

                <script>
                    fetch('./data/resumo_visualizacoes.json')
                        .then(res => res.json())
                        .then(dados => {
                            const anos = [];
                            const tempMedia = [];
                            const tempMax = [];
                            const tempMin = [];
                            const diasMax = {};
                            const diasMin = {};

                            function formatarData(dataISO) {
                                const data = new Date(dataISO);
                                return isNaN(data) ? "Data inv√°lida" : data.toLocaleDateString("pt-BR");
                            }

                            for (const ano in dados) {
                                const poaKey = "A801";
                                if (dados[ano][poaKey] && dados[ano][poaKey].temperatura) {
                                    anos.push(ano);
                                    tempMedia.push(dados[ano][poaKey].temperatura.media);
                                    tempMax.push(dados[ano][poaKey].temperatura.max);
                                    tempMin.push(dados[ano][poaKey].temperatura.min);

                                    if (dados[ano][poaKey].extremos) {
                                        diasMax[ano] = formatarData(dados[ano][poaKey].extremos.dia_temp_max);
                                        diasMin[ano] = formatarData(dados[ano][poaKey].extremos.dia_temp_min);
                                    }
                                }
                            }

                            const ctx = document.getElementById("grafico-transformacoes").getContext("2d");

                            const chart = new Chart(ctx, {
                                type: "line",
                                data: {
                                    labels: anos,
                                    datasets: [
                                        {
                                            label: "Temperatura M√°xima (¬∞C)",
                                            data: tempMax,
                                            borderColor: "#e74c3c",
                                            backgroundColor: "rgba(231,76,60,0.1)",
                                            tension: 0.4,
                                            fill: false,
                                            pointRadius: 3
                                        },

                                        {
                                            label: "Temperatura M√©dia (¬∞C)",
                                            data: tempMedia,
                                            borderColor: "#2ecc71",
                                            backgroundColor: "rgba(46,204,113,0.1)",
                                            tension: 0.4,
                                            fill: false,
                                            pointRadius: 3
                                        },

                                        {
                                            label: "Temperatura M√≠nima (¬∞C)",
                                            data: tempMin,
                                            borderColor: "#007bff",
                                            backgroundColor: "rgba(0,123,255,0.1)",
                                            tension: 0.4,
                                            fill: false,
                                            pointRadius: 3
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    interaction: {
                                        mode: "nearest",
                                        intersect: false
                                    },
                                    plugins: {
                                        tooltip: {
                                            callbacks: {
                                                label: ctx => {
                                                    const tipo = ctx.dataset.label;
                                                    const valor = ctx.formattedValue;
                                                    const ano = ctx.label;
                                                    const linhas = [`${tipo}: ${valor} ¬∞C`];

                                                    if (tipo.includes("M√°xima") && diasMax[ano]) {
                                                        linhas.push(`Registrado em:\n${diasMax[ano]}`);
                                                    }

                                                    if (tipo.includes("M√≠nima") && diasMin[ano]) {
                                                        linhas.push(`Registrado em:\n${diasMin[ano]}`);
                                                    }

                                                    return linhas;
                                                }
                                            }
                                        },
                                        legend: {
                                            display: true,
                                            position: "top",
                                            labels: {
                                                usePointStyle: true
                                            }
                                        }
                                    },
                                    scales: {
                                        y: {
                                            title: { display: true, text: "Temperatura (¬∞C)" },
                                            beginAtZero: false
                                        },
                                        x: {
                                            title: { display: true, text: "Ano" }
                                        }
                                    }
                                }
                            });

                            // === Cria√ß√£o do Range Slider ===
                            const slider = document.getElementById("range-anos");
                            noUiSlider.create(slider, {
                                start: [2000, 2025],
                                connect: true,
                                step: 1,
                                tooltips: false,
                                range: {
                                    min: 2000,
                                    max: 2025
                                },
                                format: {
                                    to: value => parseInt(value),
                                    from: value => parseInt(value)
                                }
                            });

                            const spanInicio = document.getElementById("range-inicio");
                            const spanFim = document.getElementById("range-fim");

                            function atualizarGrafico([inicio, fim]) {
                                const iInicio = anos.indexOf(inicio.toString());
                                const iFim = anos.indexOf(fim.toString()) + 1;

                                chart.data.labels = anos.slice(iInicio, iFim);
                                chart.data.datasets[0].data = tempMax.slice(iInicio, iFim);
                                chart.data.datasets[1].data = tempMedia.slice(iInicio, iFim);
                                chart.data.datasets[2].data = tempMin.slice(iInicio, iFim);
                                chart.update();
                            }

                            slider.noUiSlider.on("update", valores => {
                                const [inicio, fim] = valores.map(v => parseInt(v));
                                // Impede sele√ß√£o menor que 2 anos
                                if (fim - inicio < 1) return;

                                spanInicio.textContent = `De: ${inicio}`;
                                spanFim.textContent = `At√©: ${fim}`;
                                atualizarGrafico([inicio, fim]);
                            });
                        });
                </script>


            </div>

        </div>
    </div>



    <!---------------------------------------------------------------------------------------------------->
    <!---------------------------------------------------------------------------------------------------->
    <!-----------------------------  CONTEUDO REMOVIDO TEMPORARIAMENTE ----------------------------------->
    <!---------------------------------------------------------------------------------------------------->

    <!---------------------------------------------------------------------------------------------------->
    <!-- Se√ß√£o El Ni√±o -->
    <div class="container-fluid reveal-section vh-100 d-flex align-items-center justify-content-center " id="el-nino">
        <div class="row">
            <!-- Gr√°ficos / Mapa -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center"
                style="background-color: #f8f9fa;">

                <section class="container my-5">
                    <div class="mb-4 p-4 rounded shadow-sm bg-white border" id="charts">
                        <h4>üìä Gr√°fico de chuva acumulada</h4>
                        <hr>
                        <p class="text-muted mb-2">
                            O gr√°fico abaixo mostra a soma acumulada de chuva ao longo dos meses do ano em Porto Alegre.
                            <br><br>
                            Passe o mouse sobre os pontos para ver os valores e as datas dos extremos.
                        </p>
                        <br>
                        <center>
                            <label for="ano-comparacao" class="form-label mb-0">üìÖ Escolha um ano para
                                comparar:</label><br><br>

                            <div class="d-flex align-items-center justify-content-center flex-nowrap mb-3"
                                style="gap: 0.2rem; margin-bottom: 1rem;">
                                <div style="width: 120px;">
                                    <select id="ano-comparacao" class="form-control form-select py-2"
                                        style="max-width: 100px; height: 38px;"></select>
                                </div>
                                <button id="btn-limpar" class="btn btn-outline-secondary" style="height: 38px;">
                                    Limpar sele√ß√£o
                                </button>
                            </div>

                            <small class="text-muted">üí° Clique nas legendas para filtrar a visualiza√ß√£o:</small>
                        </center>

                        <canvas id="grafico-el-nino" height="180"></canvas>
                    </div>
                </section>

                <script>
                    fetch("./data/resumo_visualizacoes.json")
                        .then((res) => res.json())
                        .then((dados) => {
                            const acumulados2024 = new Array(12).fill(0);
                            const acumuladosAnos = {};
                            const mesesLabels = ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"];
                            const anosValidos = [];
                            const anosAdicionados = new Set(["2024"]);

                            for (const [ano, estacoes] of Object.entries(dados)) {
                                const chave = "A801";
                                if (!estacoes[chave] || !estacoes[chave].precipitacao_mensal) continue;

                                const prec = estacoes[chave].precipitacao_mensal;
                                const acumulado = [];
                                let soma = 0;

                                for (let i = 1; i <= 12; i++) {
                                    const mm = prec[String(i).padStart(2, "0")] || 0;
                                    soma += mm;
                                    acumulado.push(soma);
                                }

                                if (ano === "2024") {
                                    for (let i = 0; i < 12; i++) acumulados2024[i] = acumulado[i];
                                } else if (+ano) {
                                    acumuladosAnos[ano] = acumulado;
                                    anosValidos.push(ano);
                                }
                            }

                            anosValidos.sort((a, b) => a - b);

                            const select = document.getElementById("ano-comparacao");
                            const btnLimpar = document.getElementById("btn-limpar");

                            function atualizarSelectOrdenado() {
                                const ordenados = [...anosValidos].sort((a, b) => a - b);
                                const anosSelecionados = new Set(Array.from(select.selectedOptions).map(opt => opt.value));
                                select.innerHTML = "";
                                for (const ano of ordenados) {
                                    const opt = document.createElement("option");
                                    opt.value = ano;
                                    opt.textContent = ano;
                                    if (ano === "2023" || anosSelecionados.has(ano)) opt.selected = true;
                                    select.prepend(opt);
                                }
                            }

                            atualizarSelectOrdenado();

                            const ctx = document.getElementById("grafico-el-nino").getContext("2d");

                            const chart = new Chart(ctx, {
                                type: "line",
                                data: {
                                    labels: mesesLabels,
                                    datasets: [
                                        {
                                            label: "2024",
                                            data: acumulados2024,
                                            backgroundColor: "rgba(255, 99, 132, 0.2)",
                                            borderColor: "rgb(255, 99, 132)",
                                            fill: true,
                                            tension: 0.4,
                                            pointRadius: 3
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    plugins: {
                                        tooltip: {
                                            callbacks: {
                                                label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue} mm`
                                            }
                                        },
                                        legend: {
                                            display: true,
                                            position: "top",
                                            labels: { usePointStyle: true }
                                        }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            title: { display: true, text: "Chuva Acumulada (mm)" }
                                        },
                                        x: {
                                            title: { display: true, text: "M√™s" }
                                        }
                                    }
                                }
                            });

                            // Adiciona 2023 automaticamente se existir
                            if (acumuladosAnos["2023"]) {
                                chart.data.datasets.push({
                                    label: "2023",
                                    data: acumuladosAnos["2023"],
                                    backgroundColor: "rgba(54, 162, 235, 0.2)",
                                    borderColor: "rgb(54, 162, 235)",
                                    fill: true,
                                    tension: 0.4,
                                    pointRadius: 3
                                });
                                chart.update();
                                anosAdicionados.add("2023");
                            }

                            // ‚úÖ Adiciona automaticamente quando selecionado no <select>
                            select.addEventListener("change", () => {
                                const selecionados = Array.from(select.selectedOptions).map(opt => opt.value);
                                for (const ano of selecionados) {
                                    if (anosAdicionados.has(ano)) continue;

                                    chart.data.datasets.push({
                                        label: `${ano}`,
                                        data: acumuladosAnos[ano],
                                        backgroundColor: "rgba(54, 162, 235, 0.2)",
                                        borderColor: "rgb(54, 162, 235)",
                                        fill: true,
                                        tension: 0.4,
                                        pointRadius: 3
                                    });
                                    anosAdicionados.add(ano);
                                }
                                chart.update();
                            });

                            btnLimpar.addEventListener("click", () => {
                                chart.data.datasets = chart.data.datasets.filter(ds => ds.label === "2024");
                                chart.update();
                                anosAdicionados.clear();
                                anosAdicionados.add("2024");
                                atualizarSelectOrdenado();
                            });
                        });
                </script>


            </div>

            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 " style="background-color: #f8f9fa; ">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light h1 mb-3 sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        O El Ni√±o Chegou
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">
                        <p>
                            O El Ni√±o √© um fen√¥meno clim√°tico que ocorre quando as √°guas do Oceano Pac√≠fico Equatorial
                            ficam mais quentes do que o normal. Esse aquecimento altera os padr√µes de circula√ß√£o dos
                            ventos e das chuvas em v√°rias partes do mundo, inclusive no Brasil.
                        </p>

                        <p>
                            No Brasil, o El Ni√±o pode causar diferentes impactos, como:
                        </p>
                        <p>
                            <b>‚òÄÔ∏è Seca no Norte e Nordeste:</b>
                            O El Ni√±o tende a levar a menos chuvas nessas regi√µes, aumentando o risco de secas e
                            inc√™ndios florestais.
                        </p>
                        <p>
                            <b>üåßÔ∏è Aumento de chuvas no Sul:</b>
                            Por outro lado, a Regi√£o Sul tende a experimentar chuvas mais intensas e frequentes durante
                            um El Ni√±o.

                        </p>

                        <p>
                            Durante anos de El Ni√±o, como foi 2024, a quantidade de chuva foi muito maior do que em anos
                            anteriores. Isso significa que, ao longo do ano, a cidade de Porto Alegre e outras cidades
                            do Rio Grande do Sul receberam volumes de chuva acima da
                            m√©dia.
                        </p>

                        <p>
                            O gr√°fico ao lado mostra a <b>chuva acumulada m√™s a m√™s</b> em Porto Alegre.
                        </p>

                        <div class="alert alert-info mt-4" role="alert">
                            <strong>Dica:</strong> Selecione outros anos e compare como 2024 se comportou em rela√ß√£o aos
                            anos anteriores.
                        </div>

                        <p><!-- Finalizar conectando essa se√ß√£o com a pr√≥xima --></p>


                        <hr>
                        <div class="end-content w-100 text-center mt-4">
                            <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                se√ß√£o.</small>
                            <button class="btn btn-primary rounded-circle shadow" style="width: 55px; height: 55px;"
                                aria-label="Ir para a pr√≥xima se√ß√£o" id="explorarLaNina">
                                <span style="font-size: 1.7em; vertical-align: middle;"
                                    aria-hidden="true">&#8595;</span>
                            </button>
                        </div>

                        <script>
                            document.getElementById('explorarLaNina').addEventListener('click', function (e) {
                                e.preventDefault();
                                const target = document.querySelector('#la-nina');
                                if (target) {
                                    target.scrollIntoView({ behavior: 'smooth' });
                                }
                            });                                   
                        </script>


                    </div>
                </div>
            </div>



        </div>
    </div>


    <!---------------------------------------------------------------------------------------------------->
    <!-- Se√ß√£o La Ni√±a -->

    <div class="container-fluid reveal-section vh-100 d-flex align-items-center justify-content-center " id="la-nina">
        <div class="row">
            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 " style="background-color: #f8f9fa;">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light h1 mb-3 sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        La Ni√±a: O Contraponto
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">

                        <p>
                            Enquanto o El Ni√±o aquece as √°guas do Pac√≠fico e intensifica chuvas em regi√µes como o Sul do
                            Brasil, o fen√¥meno <strong>La Ni√±a</strong> provoca o efeito oposto. Com o resfriamento
                            an√¥malo do oceano, as
                            massas de ar se comportam de forma diferente.
                        </p>

                        <p><strong>üåßÔ∏è Aumento das chuvas no Norte e Nordeste:</strong> O La Ni√±a pode trazer mais
                            chuvas para essas regi√µes,
                            com potencial de causar enchentes, especialmente no setor norte do Nordeste (Maranh√£o,
                            Piau√≠, Cear√° e Rio Grande do Norte). </p>
                        <p><strong>‚òÄÔ∏è Diminui√ß√£o das chuvas no Sul:</strong> A regi√£o Sul pode enfrentar um per√≠odo mais
                            seco durante a La
                            Ni√±a. </p>

                        <p>El Ni√±o e La Ni√±a alternam-se em ciclos de tr√™s a cinco anos, afetando diretamente o clima
                            regional.</p>

                        <p>Nos √∫ltimos anos, esses ciclos parecem estar se tornando mais curtos e intensos,
                            possivelmente em fun√ß√£o do aquecimento global.</p>

                        <p>Isso aumenta os riscos de desastres como enchentes, estiagens e colapsos urbanos.</p>



                        <hr>

                        <div class="end-content w-100 text-center mt-4">
                            <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                se√ß√£o.</small>
                            <button class="btn btn-primary rounded-circle shadow" style="width: 55px; height: 55px;"
                                aria-label="Ir para a pr√≥xima se√ß√£o">
                                <span style="font-size: 1.7em; vertical-align: middle;"
                                    aria-hidden="true">&#8595;</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos / Mapa -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center"
                style="background-color: #f8f9fa;">

                <div class="mb-4 p-4 rounded shadow-sm bg-white border" id="charts">
                    <h4>üìä Gr√°fico de Precipita√ß√£o x Temperatura</h4>
                    <hr>
                    <p class="text-muted mb-2 ">Este gr√°fico mostra, para cada ano, a soma total de chuva (barras azuis)
                        e a temperatura m√©dia anual (linha vermelha) em Porto Alegre.<br>
                        <br>
                        Passe o mouse sobre as barras e a linha para ver os valores exatos de cada ano.
                    </p>
                    <br>
                    <center>
                        <small class="text-muted">üí° Clique nas legendas para filtrar a visualiza√ß√£o:</small>
                    </center>
                    <canvas id="gangorraChart"></canvas>
                </div>

            </div>


            <script>
                async function carregarDados() {
                    const resposta = await fetch("./data/resumo_visualizacoes.json");
                    const dados = await resposta.json();

                    const anos = Object.keys(dados).sort();
                    const estacao = Object.values(dados[anos[0]])[0];

                    const precipitacao = anos.map(ano => {
                        const est = Object.values(dados[ano])[0];
                        return est.precipitacao?.soma || null;
                    });

                    const temperatura = anos.map(ano => {
                        const est = Object.values(dados[ano])[0];
                        return est.temperatura?.media || null;
                    });

                    const ctx = document.getElementById('gangorraChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: anos,
                            datasets: [
                                {
                                    label: 'Precipita√ß√£o Total (mm)',
                                    data: precipitacao,
                                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                    yAxisID: 'y',
                                    borderRadius: 5
                                },
                                {
                                    label: 'Temperatura M√©dia (¬∞C)',
                                    data: temperatura,
                                    type: 'line',
                                    borderColor: 'red',
                                    backgroundColor: 'red',
                                    yAxisID: 'y1',
                                    tension: 0.3,
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            stacked: false,
                            plugins: {
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                },
                                legend: {
                                    position: 'top'
                                },
                                title: {
                                    display: false,
                                    text: 'Gangorra Clim√°tica: Precipita√ß√£o x Temperatura ao Longo dos Anos'
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: 'Precipita√ß√£o (mm)'
                                    }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    grid: {
                                        drawOnChartArea: false
                                    },
                                    title: {
                                        display: true,
                                        text: 'Temperatura (¬∞C)'
                                    }
                                }
                            }
                        }
                    });
                }

                carregarDados();
            </script>

        </div>
    </div>


    <!---------------------------------------------------------------------------------------------------->


    <!---------------------------------------------------------------------------------------------------->


    <div class="container-fluid reveal-section  vh-100 d-flex align-items-center justify-content-center "
        id="transformacoes">
        <div class="row">

            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 " style="background-color: #f8f9fa; ">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light h1 mb-3 sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        Radia√ß√£o Solar e Calor Urbano
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">
                        <p>Os dados de radia√ß√£o solar mostram aumento ao longo dos anos. C√©us mais limpos significam
                            dias mais quentes, intensificando o calor nas cidades.</p>

                        <p>Esse fen√¥meno, combinado com o El Ni√±o, contribui para um ciclo de calor e umidade que
                            favorece eventos extremos.</p>

                        <hr>

                        <div class="end-content w-100 text-center mt-4">
                            <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                se√ß√£o.</small>
                            <button class="btn btn-primary rounded-circle shadow" style="width: 55px; height: 55px;"
                                aria-label="Ir para a pr√≥xima se√ß√£o">
                                <span style="font-size: 1.7em; vertical-align: middle;"
                                    aria-hidden="true">&#8595;</span>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
            <!-- Gr√°ficos / Mapa -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center"
                style="background-color: #f8f9fa;">





                <div class="mb-4 p-4 rounded shadow-sm bg-white border" id="charts">
                    <h4>üìä Gr√°fico de Radia√ß√£o Solar Anual</h4>
                    <hr>
                    <p class="text-muted mb-2 ">
                        Este gr√°fico mostra a evolu√ß√£o da radia√ß√£o solar ao longo dos anos em Porto Alegre.
                        <br><br>
                        A linha azul representa a radia√ß√£o anual medida em kJ/m¬≤, enquanto a linha vermelha indica a
                        m√©dia hist√≥rica de radia√ß√£o anual (2000‚Äì2023).
                    </p>
                    <br>
                    <center>
                        <small class="text-muted">üí° Clique nas legendas para filtrar a visualiza√ß√£o:</small>
                    </center>
                    <canvas id="graficoRadiacaoArea"></canvas>


                    <script>
                        fetch('./data/resumo_visualizacoes.json')
                            .then(res => res.json())
                            .then(dados => {
                                const anos = Object.keys(dados)
                                    .filter(ano => !isNaN(ano))
                                    .sort((a, b) => a - b);

                                const valoresRadiacao = anos.map(ano => {
                                    const dadosAno = dados[ano];
                                    const a801 = dadosAno["A801"];
                                    return a801?.radiacao_anual ?? null;
                                });

                                const valoresValidos = valoresRadiacao.filter(v => v !== null && v !== 0);
                                const mediaHistorica = valoresValidos.reduce((a, b) => a + b, 0) / valoresValidos.length;

                                const anosAcimaMedia = anos.filter((ano, i) =>
                                    valoresRadiacao[i] !== null && valoresRadiacao[i] > mediaHistorica
                                );

                                const ctx = document.getElementById("graficoRadiacaoArea").getContext("2d");

                                new Chart(ctx, {
                                    type: "line",
                                    data: {
                                        labels: anos,
                                        datasets: [
                                            {
                                                label: "Radia√ß√£o Anual (kJ/m¬≤)",
                                                data: valoresRadiacao,
                                                fill: true,
                                                backgroundColor: "rgba(54, 162, 235, 0.2)",
                                                borderColor: "rgba(54, 162, 235, 1)",
                                                tension: 0.4,
                                                pointRadius: 3
                                            },
                                            {
                                                label: "M√©dia Hist√≥rica (2000‚Äì2023)",
                                                data: Array(anos.length).fill(mediaHistorica),
                                                borderColor: "rgba(255, 99, 132, 1)",
                                                borderDash: [6, 6],
                                                pointRadius: 0,
                                                fill: false,
                                                tension: 0
                                            }
                                        ]
                                    },
                                    options: {
                                        responsive: true,
                                        plugins: {
                                            legend: { position: "top" },
                                            tooltip: {
                                                callbacks: {
                                                    label: ctx => `${ctx.dataset.label}: ${ctx.formattedValue} kJ/m¬≤`,
                                                    afterBody: context => {
                                                        const ano = context[0].label;
                                                        return anosAcimaMedia.includes(ano)
                                                            ? '‚ö†Ô∏è Acima da m√©dia hist√≥rica'
                                                            : '‚úÖ Dentro da m√©dia hist√≥rica';
                                                    }
                                                }
                                            }
                                        },
                                        scales: {
                                            y: {
                                                title: {
                                                    display: true,
                                                    text: "kJ/m¬≤ acumulados no ano"
                                                }
                                            },
                                            x: {
                                                title: {
                                                    display: true,
                                                    text: "Ano"
                                                }
                                            }
                                        }
                                    }
                                });
                            });
                    </script>



                </div>
            </div>

        </div>
    </div>

    <!---------------------------------------------------------------------------------------------------->


    <div class="container-fluid reveal-section  vh-100 d-flex align-items-center justify-content-center "
        id="transformacoes">
        <div class="row">

            <!-- Gr√°ficos / Mapa -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center"
                style="background-color: #f8f9fa;">


                <div class="mb-4 p-4 rounded shadow-sm bg-white border" id="charts">
                    <h4>üìä ...</h4>
                    <hr>
                    <p class="text-muted mb-2 ">O que √©?
                        <br><br>
                        Como usar?
                    </p>
                    <br>


                </div>
            </div>



            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 " style="background-color: #f8f9fa; ">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light h1 mb-3 sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        Press√£o Atmosf√©rica: Um Sinal Antecipado
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">
                        <p>Quedas na press√£o atmosf√©rica indicam aproxima√ß√£o de frentes frias. Nos dias que antecederam
                            a enchente de 2024, as esta√ß√µes registraram quedas sucessivas, evidenciando a gravidade da
                            situa√ß√£o.</p>

                        <hr>

                        <div class="end-content w-100 text-center mt-4">
                            <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                se√ß√£o.</small>
                            <button class="btn btn-primary rounded-circle shadow" style="width: 55px; height: 55px;"
                                aria-label="Ir para a pr√≥xima se√ß√£o">
                                <span style="font-size: 1.7em; vertical-align: middle;"
                                    aria-hidden="true">&#8595;</span>
                            </button>
                        </div>



                    </div>
                </div>
            </div>


        </div>
    </div>


    <!---------------------------------------------------------------------------------------------------->


    <div class="container-fluid reveal-section  vh-100 d-flex align-items-center justify-content-center "
        id="transformacoes">
        <div class="row">


            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 " style="background-color: #f8f9fa; ">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light h1 mb-3 sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        Ventos e Umidade
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">
                        <p>A dire√ß√£o e velocidade dos ventos tamb√©m influenciam a reten√ß√£o de umidade na atmosfera. Em
                            2024, ventos predominantes impediram a dispers√£o das nuvens sobre Porto Alegre.</p>

                        <hr>

                        <div class="end-content w-100 text-center mt-4">
                            <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                se√ß√£o.</small>
                            <button class="btn btn-primary rounded-circle shadow" style="width: 55px; height: 55px;"
                                aria-label="Ir para a pr√≥xima se√ß√£o">
                                <span style="font-size: 1.7em; vertical-align: middle;"
                                    aria-hidden="true">&#8595;</span>
                            </button>
                        </div>



                    </div>
                </div>
            </div>

            <!-- Gr√°ficos / Mapa -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center"
                style="background-color: #f8f9fa;">


                <div class="mb-4 p-4 rounded shadow-sm bg-white border" id="charts">
                    <h4>üìä ...</h4>
                    <hr>
                    <p class="text-muted mb-2 ">O que √©?
                        <br><br>
                        Como usar?
                    </p>
                    <br>


                </div>
            </div>

        </div>
    </div>


    <!---------------------------------------------------------------------------------------------------->


    <div class="container-fluid reveal-section  vh-100 d-flex align-items-center justify-content-center "
        id="transformacoes">
        <div class="row">
            <!-- Gr√°ficos / Mapa -->
            <div class="col-sm-12 col-md-12 col-lg-6 justify-content-center align-items-center"
                style="background-color: #f8f9fa;">


                <div class="mb-4 p-4 rounded shadow-sm bg-white border" id="charts">
                    <h4>üìä ...</h4>
                    <hr>
                    <p class="text-muted mb-2 ">O que √©?
                        <br><br>
                        Como usar?
                    </p>
                    <br>


                </div>
            </div>

            <!-- Storytelling -->
            <div class="col-sm-12 col-md-12 col-lg-6 " style="background-color: #f8f9fa; ">
                <div class="col-12 d-flex flex-column">
                    <h1 class="bg-light h1 mb-3 sticky-top" id="estacoes-title"
                        style="padding: 50px 0px 30px 0px; background-color: #f8f9fa;" tabindex="0">
                        O Ponto de Orvalho
                    </h1>

                    <div class="col-12 justify-content-center align-items-center">
                        <p>O ponto de orvalho indica a satura√ß√£o do ar. Em per√≠odos de El Ni√±o, os valores tendem a ser
                            mais altos, favorecendo chuvas intensas e sensa√ß√£o t√©rmica elevada.</p>

                        <hr>

                        <div class="end-content w-100 text-center mt-4">
                            <small class="mb-2 text-muted">Clique no bot√£o abaixo para seguir para a pr√≥xima
                                se√ß√£o.</small>
                            <button class="btn btn-primary rounded-circle shadow" style="width: 55px; height: 55px;"
                                aria-label="Ir para a pr√≥xima se√ß√£o">
                                <span style="font-size: 1.7em; vertical-align: middle;"
                                    aria-hidden="true">&#8595;</span>
                            </button>
                        </div>



                    </div>
                </div>
            </div>


        </div>
    </div>





















    <!-- Rodap√© -->
    <footer class="bg-light text-center text-lg-start">
        <div class="text-center p-4" style="background-color: #f8f9fa;">
            2025 ¬© Todos os direitos reservados.
        </div>


        <script>
            // Revela os elementos da se√ß√£o aos poucos
            document.addEventListener("DOMContentLoaded", function () {
                function revealSequentially(items, delay = 350) {
                    items.forEach((item, idx) => {
                        setTimeout(() => {
                            item.classList.add('visible');
                        }, idx * delay);
                    });
                }

                const section = document.getElementById('estacoes-meteorologicas');
                const revealItems = section.querySelectorAll('.reveal-item');
                let revealed = false;

                function handleReveal(entries, observer) {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && !revealed) {
                            revealSequentially(Array.from(revealItems));
                            revealed = true;
                            observer.disconnect();
                        }
                    });
                }

                const observer = new IntersectionObserver(handleReveal, { threshold: 0.2 });
                observer.observe(section);
            });
        </script>

        <!-- Mapa e gr√°fico de esta√ß√µes -->
        <script>
            const map = L.map('map').setView([-30.5, -53], 7.0);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            let marcadores = [];
            let estacoes = [];
            let intervalo = null;
            let chart;

            async function carregarEstacoes() {
                const resp = await fetch('./data/estacoes.json');
                estacoes = await resp.json();
                atualizarMapa(parseInt(document.getElementById('yearSlider').value));
                desenharGrafico();
            }

            function normalizarData(data) {
                if (data.includes('/')) {
                    const [dia, mes, ano] = data.split('/');
                    return `${ano.length === 2 ? '20' + ano : ano}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;
                }
                return data;
            }

            function formatarDataParaBR(dataISO) {
                const [ano, mes, dia] = dataISO.split('-');
                return `${dia}/${mes}/${ano}`;
            }

            function atualizarMapa(ano) {
                marcadores.forEach(m => map.removeLayer(m));
                marcadores = [];

                estacoes
                    .map(est => ({ ...est, data_fundacao: normalizarData(est.data_fundacao) }))
                    .filter(est => parseInt(est.data_fundacao.substring(0, 4)) <= ano)
                    .forEach(est => {
                        const dataBR = formatarDataParaBR(est.data_fundacao);
                        const marker = L.marker([est.latitude, est.longitude])
                            .bindPopup(`
                                <div style="min-width:200px;">
                                    <h5 style="margin-bottom: 0.5em; color: #1976d2;">
                                        <i class="fas fa-map-marker-alt me-2"></i> ${est.estacao}
                                    </h5>
                                    <p style="margin-bottom: 0.3em;">
                                        <span class="badge bg-primary text-white" style="font-size:0.9em;"> ${est.uf}</span>
                                    </p>
                                    <p style="margin-bottom: 0.3em;">
                                        <i class="fas fa-calendar-alt me-1"></i><strong> Coletando dados de:</strong> ${dataBR}
                                    </p>
                                    ${est.municipio ? `<p style="margin-bottom: 0.3em;"><i class="fas fa-city me-1"></i><strong> Munic√≠pio:</strong> ${est.municipio}</p>` : ''}
                                    ${est.altitude ? `<p style="margin-bottom: 0.3em;"><i class="fas fa-mountain me-1"></i><strong> Altitude:</strong> ${est.altitude} m</p>` : ''}
                                    ${est.tipo ? `<p style="margin-bottom: 0.3em;"><i class="fas fa-info-circle me-1"></i><strong> Tipo:</strong> ${est.tipo}</p>` : ''}
                                </div>
                            `)
                            .addTo(map);
                        marcadores.push(marker);
                    });
            }

            function desenharGrafico() {
                const anos = {};
                estacoes.forEach(est => {
                    const ano = parseInt(normalizarData(est.data_fundacao).substring(0, 4));
                    anos[ano] = (anos[ano] || 0) + 1;
                });
                const labels = Object.keys(anos).sort((a, b) => a - b);
                const dados = labels.map(ano => anos[ano]);

                const ctx = document.getElementById('graficoEstacoes').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Esta√ß√µes por Ano de Funda√ß√£o',
                            data: dados,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        scales: {
                            x: { title: { display: true, text: 'Ano' } },
                            y: { title: { display: true, text: 'N√∫mero de Esta√ß√µes' }, beginAtZero: true }
                        }
                    }
                });
                if (marcadores.length > 0) {
                    const popupContent = marcadores[0].getPopup().getContent();
                    const instrucoes = `<hr><p class='text-center'><strong> üìç ESTE MAPA √â INTERATIVO</strong><p class='text-muted'>Clique nas esta√ß√µes para ver mais detalhes.</p></p>`;
                    marcadores[0].getPopup().setContent(popupContent + instrucoes);
                    marcadores[0].openPopup();
                }
            }

            const slider = document.getElementById('yearSlider');
            const label = document.getElementById('yearLabel');
            const btn = document.getElementById('playBtn');
            //const resetBtn = document.getElementById('resetBtn');

            slider.addEventListener('input', () => {
                const ano = parseInt(slider.value);
                label.textContent = ano;
                atualizarMapa(ano);
            });

            //resetBtn.addEventListener('click', () => {
            //    map.setView([-30.5, -53], 6.5)
            //});

            btn.addEventListener('click', () => {
                if (intervalo) {
                    clearInterval(intervalo);
                    intervalo = null;
                    btn.textContent = '‚ñ∂Ô∏è Ver evolu√ß√£o';
                } else {
                    if (parseInt(slider.value) >= 2025) {
                        slider.value = 2000;
                        label.textContent = 2000;
                        atualizarMapa(2000);
                    }
                    intervalo = setInterval(() => {
                        let ano = parseInt(slider.value);
                        if (ano < 2025) {
                            ano++;
                            slider.value = ano;
                            label.textContent = ano;
                            atualizarMapa(ano);
                        } else {
                            clearInterval(intervalo);
                            intervalo = null;
                            btn.textContent = '‚ñ∂Ô∏è Reproduzir novamente';
                            setTimeout(() => {
                                btn.textContent = '‚ñ∂Ô∏è Ver evolu√ß√£o';
                            }, 2000);
                        }
                    }, 150);
                    btn.textContent = '‚è∏Ô∏è Pausar';
                }
            });

            carregarEstacoes();
        </script>



        <script src="./assets/js/script.js"></script>
        <script src="./assets/js/d3-charts.js"></script>
        <script src="./assets/js/jquery-3.5.1.slim.min.js"></script>
        <script src="./assets/js/popper.min.js"></script>
        <script src="./assets/js/bootstrap.min.js"></script>
        <script src="./assets/js/papaparse.min.js"></script>
</body>

</html>

</body>