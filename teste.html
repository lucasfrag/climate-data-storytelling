<canvas id="graficoTemperaturaMedia"></canvas>

<script>
fetch('./data/resumo_visualizacoes.json')
  .then(res => res.json())
  .then(dados => {
    const estacao = "A801";
    const anos = Object.keys(dados).filter(ano => !isNaN(ano) && ano !== "2025").sort();

    const temperaturas = anos.map(ano => dados[ano]?.[estacao]?.temperatura?.media ?? null);
    const validas = temperaturas.filter(v => v !== null);
    const mediaHistorica = validas.reduce((a, b) => a + b, 0) / validas.length;

    new Chart(document.getElementById('graficoTemperaturaMedia'), {
      type: 'line',
      data: {
        labels: anos,
        datasets: [
          {
            label: 'Temperatura Média (°C)',
            data: temperaturas,
            fill: true,
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            pointRadius: 3,
            tension: 0.4
          },
          {
            label: 'Média Histórica (2000–2024)',
            data: new Array(anos.length).fill(mediaHistorica),
            borderColor: 'rgba(54, 162, 235, 0.7)',
            borderDash: [5, 5],
            pointRadius: 0,
            tension: 0
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Temperatura Média Anual em Porto Alegre (2000–2024)'
          },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.dataset.label}: ${ctx.raw.toFixed(1)} °C`
            }
          }
        },
        scales: {
          y: {
            title: { display: true, text: 'Temperatura (°C)' }
          },
          x: {
            title: { display: true, text: 'Ano' }
          }
        }
      }
    });
  });
</script>
