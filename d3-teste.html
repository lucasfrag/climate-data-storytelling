<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Hist√≥rico Clim√°tico Porto Alegre</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      overflow-y: scroll;
      background-color: #fafafa;
      scroll-snap-type: y mandatory;
    }

    .slide {
      width: 100vw;
      height: 100vh;
      padding: 40px;
      box-sizing: border-box;
      border-bottom: 1px solid #ddd;
      scroll-snap-align: start;
    }

    .title {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .description {
      font-size: 18px;
      max-width: 700px;
      margin-bottom: 20px;
    }

    svg {
      background: white;
      box-shadow: 0 0 10px #ccc;
      border-radius: 8px;
    }

    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 14px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
    }
  </style>
</head>

<body>

  <div class="tooltip" id="tooltip"></div>

  <!-- Slide 1: Introdu√ß√£o -->
  <div class="slide">
    <div class="title">üåé Introdu√ß√£o</div>
    <div class="description">
      Explore as mudan√ßas clim√°ticas em Porto Alegre de 2000 a 2025. Role para baixo para ver dados anuais, eventos
      extremos e padr√µes meteorol√≥gicos revelados por nossos sensores ao longo dos anos.
    </div>
  </div>

  <!-- Slide 2: Temperatura M√©dia Anual -->
  <div class="slide" id="slide-linha">
    <div class="title">üìà Temperatura M√©dia Anual</div>
    <svg id="grafico-linha" width="800" height="400"></svg>
  </div>

  <!-- Slide 3: Precipita√ß√£o Anual -->
  <div class="slide" id="slide-area">
    <div class="title">üåßÔ∏è Precipita√ß√£o Acumulada por Ano</div>
    <svg id="grafico-area" width="800" height="400"></svg>
  </div>

  <!-- Slide 4: Eventos Extremos -->
  <div class="slide">
    <div class="title">üö® Eventos Clim√°ticos Extremos</div>
    <div class="description">
      <ul>
        <li><strong>2005</strong>: Chuva recorde em setembro (352 mm)</li>
        <li><strong>2010</strong>: Onda de calor em janeiro (at√© 42¬∞C)</li>
        <li><strong>2023</strong>: Enchentes hist√≥ricas em maio no RS</li>
      </ul>
    </div>
  </div>

  <!-- Slide 5: Mapa Clim√°tico -->
  <div class="slide" id="slide-mapa">
    <div class="title">üó∫Ô∏è Mapa de Temperaturas Anuais</div>
    <div class="description">Passe o mouse sobre os c√≠rculos para ver a temperatura m√©dia anual em diferentes locais da
      regi√£o.</div>
    <svg id="mapa-climatico" width="800" height="400"></svg>
  </div>

  <!-- Slide 6: Umidade Relativa -->
  <div class="slide" id="slide-umidade">
    <div class="title">üíß Umidade Relativa M√©dia Anual</div>
    <div class="description">Explore a varia√ß√£o da umidade relativa ao longo dos anos. Passe o mouse sobre os pontos
      para ver os valores.</div>
    <svg id="grafico-umidade" width="800" height="400"></svg>
  </div>

  <!-- Slide 7: Velocidade do Vento -->
  <div class="slide" id="slide-vento">
    <div class="title">üå¨Ô∏è Velocidade M√©dia do Vento</div>
    <div class="description">
      Este gr√°fico mostra a velocidade m√©dia do vento em Porto Alegre ao longo dos anos. Valores mais altos indicam anos
      com ventos mais intensos, o que pode impactar diretamente a sensa√ß√£o t√©rmica e a dispers√£o de poluentes.
    </div>
    <svg id="grafico-vento" width="800" height="400"></svg>
  </div>

  <!-- Slide 8: Eventos de Temperatura Extrema -->
  <div class="slide" id="slide-extremos">
    <div class="title">üî• Eventos de Temperatura Extrema</div>
    <div class="description">
      Neste gr√°fico, voc√™ ver√° as temperaturas m√°ximas e m√≠nimas registradas por ano. Picos de calor ou frio extremo
      ajudam a entender os limites clim√°ticos enfrentados pela popula√ß√£o ao longo do tempo.
    </div>
    <svg id="grafico-extremos" width="800" height="400"></svg>
  </div>

  <!-- Slide 9: Dias de Calor/Frio Intensos -->
  <div class="slide" id="slide-intensos">
    <div class="title">‚ùÑÔ∏è Dias de Calor/Frio Intensos</div>
    <div class="description">
      Aqui mostramos o n√∫mero de dias em cada ano em que ocorreram temperaturas consideradas extremas ‚Äî muito calor ou
      muito frio. Esse tipo de informa√ß√£o √© √∫til para compreender o impacto real das mudan√ßas clim√°ticas na rotina das
      pessoas.
    </div>
    <svg id="grafico-intensos" width="800" height="400"></svg>
  </div>

  <!-- Slides de dire√ß√£o do vento -->
  <div class="slide" id="slide-vento-direcao">
    <div class="title">üå¨Ô∏è Dire√ß√£o do Vento</div>
    <div class="description">
      A rosa dos ventos mostra a frequ√™ncia com que os ventos sopram de diferentes dire√ß√µes. Isso √© √∫til para entender
      padr√µes de circula√ß√£o de ar na regi√£o.
    </div>
    <svg id="grafico-vento-direcao" width="800" height="400"></svg>
  </div>

  <script>
    // Dados de exemplo
    const dados = [
      { ano: 2000, temp: 21.3, chuva: 1200 },
      { ano: 2005, temp: 21.7, chuva: 1580 },
      { ano: 2010, temp: 22.4, chuva: 1420 },
      { ano: 2015, temp: 22.9, chuva: 1350 },
      { ano: 2020, temp: 23.5, chuva: 1480 },
      { ano: 2025, temp: 24.1, chuva: 1600 }
    ];

    const regioes = [
      { nome: "Zona Norte", x: 150, y: 100, temp: 22.4 },
      { nome: "Centro", x: 300, y: 200, temp: 23.1 },
      { nome: "Zona Sul", x: 500, y: 300, temp: 24.0 }
    ];

    const dadosVento = [
      { ano: 2000, vento: 2.4 },
      { ano: 2005, vento: 2.8 },
      { ano: 2010, vento: 3.1 },
      { ano: 2015, vento: 2.7 },
      { ano: 2020, vento: 3.3 }
    ];

    const dadosExtremos = [
      { ano: 2000, max: 39, min: 3 },
      { ano: 2005, max: 41, min: 2 },
      { ano: 2010, max: 43, min: 1 },
      { ano: 2015, max: 40, min: 4 },
      { ano: 2020, max: 42, min: 3 }
    ];

    const dadosIntensos = [
      { ano: 2000, calor: 18, frio: 10 },
      { ano: 2005, calor: 22, frio: 8 },
      { ano: 2010, calor: 26, frio: 6 },
      { ano: 2015, calor: 20, frio: 9 },
      { ano: 2020, calor: 25, frio: 7 }
    ];

    const direcoes = [
      { dir: "N", freq: 12 },
      { dir: "NE", freq: 18 },
      { dir: "E", freq: 22 },
      { dir: "SE", freq: 14 },
      { dir: "S", freq: 10 },
      { dir: "SO", freq: 8 },
      { dir: "O", freq: 6 },
      { dir: "NO", freq: 10 }
    ];

    // Sele√ß√£o do tooltip
    const tooltip = d3.select("#tooltip");

    // Vari√°veis para controle de anima√ß√£o
    const animacoes = {
      linha: false,
      area: false,
      mapa: false,
      umidade: false,
      vento: false,
      extremos: false,
      intensos: false,
      ventoDirecao: false
    };

    // Configura√ß√£o do IntersectionObserver para anima√ß√£o dos slides
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          switch(entry.target.id) {
            case 'slide-linha':
              if (!animacoes.linha) {
                animarLinha();
                animacoes.linha = true;
              }
              break;
            case 'slide-area':
              if (!animacoes.area) {
                animarArea();
                animacoes.area = true;
              }
              break;
            case 'slide-mapa':
              if (!animacoes.mapa) {
                animarMapa();
                animacoes.mapa = true;
              }
              break;
            case 'slide-umidade':
              if (!animacoes.umidade) {
                animarUmidade();
                animacoes.umidade = true;
              }
              break;
            case 'slide-vento':
              if (!animacoes.vento) {
                animarVento();
                animacoes.vento = true;
              }
              break;
            case 'slide-extremos':
              if (!animacoes.extremos) {
                animarExtremos();
                animacoes.extremos = true;
              }
              break;
            case 'slide-intensos':
              if (!animacoes.intensos) {
                animarIntensos();
                animacoes.intensos = true;
              }
              break;
            case 'slide-vento-direcao':
              if (!animacoes.ventoDirecao) {
                desenharGraficoVentoDirecao();
                animacoes.ventoDirecao = true;
              }
              break;
          }
        }
      });
    }, { threshold: 0.5 });

    // Observa todos os slides que precisam de anima√ß√£o
    document.querySelectorAll('.slide[id]').forEach(slide => {
      observer.observe(slide);
    });

    // Fun√ß√µes de anima√ß√£o
    function animarLinha() {
      const svg = d3.select("#grafico-linha"),
        margin = { top: 20, right: 30, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleLinear().domain(d3.extent(dados, d => d.ano)).range([0, width]);
      const y = d3.scaleLinear().domain([20, d3.max(dados, d => d.temp)]).nice().range([height, 0]);
      const line = d3.line().x(d => x(d.ano)).y(d => y(d.temp));

      g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format("d")));
      g.append("g").call(d3.axisLeft(y));

      const path = g.append("path")
        .datum(dados)
        .attr("fill", "none")
        .attr("stroke", "tomato")
        .attr("stroke-width", 2)
        .attr("d", line);

      const totalLength = path.node().getTotalLength();
      path.attr("stroke-dasharray", totalLength).attr("stroke-dashoffset", totalLength)
        .transition().duration(2000).attr("stroke-dashoffset", 0);

      g.selectAll("circle")
        .data(dados)
        .enter().append("circle")
        .attr("cx", d => x(d.ano))
        .attr("cy", d => y(d.temp))
        .attr("r", 5)
        .attr("fill", "tomato")
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.ano}</strong><br>Temperatura: ${d.temp}¬∞C`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0));
    }

    function animarArea() {
      const svg = d3.select("#grafico-area"),
        margin = { top: 20, right: 30, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleLinear().domain(d3.extent(dados, d => d.ano)).range([0, width]);
      const y = d3.scaleLinear().domain([1000, d3.max(dados, d => d.chuva)]).nice().range([height, 0]);
      const area = d3.area().x(d => x(d.ano)).y0(height).y1(d => y(d.chuva));

      g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format("d")));
      g.append("g").call(d3.axisLeft(y));

      g.append("path")
        .datum(dados)
        .attr("fill", "steelblue")
        .attr("opacity", 0)
        .attr("d", area)
        .transition().duration(2000).attr("opacity", 1);

      g.selectAll("circle")
        .data(dados)
        .enter().append("circle")
        .attr("cx", d => x(d.ano))
        .attr("cy", d => y(d.chuva))
        .attr("r", 5)
        .attr("fill", "steelblue")
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.ano}</strong><br>Precipita√ß√£o: ${d.chuva} mm`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0));
    }

    function animarMapa() {
      const svg = d3.select("#mapa-climatico"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

      svg.selectAll("circle")
        .data(regioes)
        .enter().append("circle")
        .attr("cx", d => d.x)
        .attr("cy", d => d.y)
        .attr("r", 0)
        .attr("fill", "orange")
        .attr("opacity", 0.8)
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.nome}</strong><br>Temperatura m√©dia: ${d.temp}¬∞C`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0))
        .transition()
        .duration(1000)
        .delay((_, i) => i * 300)
        .attr("r", 20);

      svg.selectAll("text.label")
        .data(regioes)
        .enter().append("text")
        .attr("class", "label")
        .attr("x", d => d.x)
        .attr("y", d => d.y - 30)
        .attr("text-anchor", "middle")
        .attr("fill", "#333")
        .text(d => d.nome);
    }

    function animarUmidade() {
      const svg = d3.select("#grafico-umidade"),
        margin = { top: 20, right: 30, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      const dadosUmidade = [
        { ano: 2000, umid: 76 },
        { ano: 2005, umid: 77 },
        { ano: 2010, umid: 78 },
        { ano: 2015, umid: 75 },
        { ano: 2020, umid: 79 },
        { ano: 2025, umid: 80 },
      ];

      const x = d3.scaleLinear().domain(d3.extent(dadosUmidade, d => d.ano)).range([0, width]);
      const y = d3.scaleLinear().domain([70, 85]).range([height, 0]);

      g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format("d")));
      g.append("g").call(d3.axisLeft(y));

      const line = d3.line().x(d => x(d.ano)).y(d => y(d.umid));

      g.append("path")
        .datum(dadosUmidade)
        .attr("fill", "none")
        .attr("stroke", "blue")
        .attr("stroke-width", 2)
        .attr("d", line)
        .attr("stroke-dasharray", function () { return this.getTotalLength(); })
        .attr("stroke-dashoffset", function () { return this.getTotalLength(); })
        .transition().duration(2000)
        .attr("stroke-dashoffset", 0);

      g.selectAll("circle")
        .data(dadosUmidade)
        .enter().append("circle")
        .attr("cx", d => x(d.ano))
        .attr("cy", d => y(d.umid))
        .attr("r", 5)
        .attr("fill", "blue")
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.ano}</strong><br>Umidade relativa: ${d.umid}%`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0));
    }

    function animarVento() {
      desenharGraficoBarra("#grafico-vento", dadosVento, "vento", "green", "Velocidade (m/s)");
    }

    function animarIntensos() {
      const svg = d3.select("#grafico-intensos"),
        margin = { top: 20, right: 30, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleBand().domain(dadosIntensos.map(d => d.ano)).range([0, width]).padding(0.2);
      const y = d3.scaleLinear().domain([0, d3.max(dadosIntensos, d => Math.max(d.calor, d.frio))]).range([height, 0]);

      g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format("d")));
      g.append("g").call(d3.axisLeft(y));

      // Barras de calor
      g.selectAll(".bar-calor")
        .data(dadosIntensos)
        .enter().append("rect")
        .attr("class", "bar-calor")
        .attr("x", d => x(d.ano))
        .attr("width", x.bandwidth() / 2)
        .attr("y", y(0))
        .attr("height", 0)
        .attr("fill", "darkorange")
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.ano}</strong><br>Dias de calor: ${d.calor}`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0))
        .transition().duration(1000)
        .attr("y", d => y(d.calor))
        .attr("height", d => height - y(d.calor));

      // Barras de frio
      g.selectAll(".bar-frio")
        .data(dadosIntensos)
        .enter().append("rect")
        .attr("class", "bar-frio")
        .attr("x", d => x(d.ano) + x.bandwidth() / 2)
        .attr("width", x.bandwidth() / 2)
        .attr("y", y(0))
        .attr("height", 0)
        .attr("fill", "deepskyblue")
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.ano}</strong><br>Dias de frio: ${d.frio}`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0))
        .transition().duration(1000)
        .attr("y", d => y(d.frio))
        .attr("height", d => height - y(d.frio));
    }

    function animarExtremos() {
      const svg = d3.select("#grafico-extremos"),
        margin = { top: 20, right: 30, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleBand().domain(dadosExtremos.map(d => d.ano)).range([0, width]).padding(0.2);
      const y = d3.scaleLinear().domain([0, 45]).range([height, 0]);

      g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format("d")));
      g.append("g").call(d3.axisLeft(y));

      g.selectAll(".bar-max")
        .data(dadosExtremos)
        .enter().append("rect")
        .attr("class", "bar-max")
        .attr("x", d => x(d.ano))
        .attr("width", x.bandwidth() / 2)
        .attr("y", y(0))
        .attr("height", 0)
        .attr("fill", "tomato")
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.ano}</strong><br>Temp. M√°x: ${d.max}¬∞C`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0))
        .transition().duration(1000)
        .attr("y", d => y(d.max)).attr("height", d => height - y(d.max));

      g.selectAll(".bar-min")
        .data(dadosExtremos)
        .enter().append("rect")
        .attr("class", "bar-min")
        .attr("x", d => x(d.ano) + x.bandwidth() / 2)
        .attr("width", x.bandwidth() / 2)
        .attr("y", y(0))
        .attr("height", 0)
        .attr("fill", "royalblue")
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.ano}</strong><br>Temp. M√≠n: ${d.min}¬∞C`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0))
        .transition().duration(1000)
        .attr("y", d => y(d.min)).attr("height", d => height - y(d.min));
    }

    function desenharGraficoBarra(id, dados, chave, cor, label) {
      const svg = d3.select(id),
        margin = { top: 20, right: 30, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleBand().domain(dados.map(d => d.ano)).range([0, width]).padding(0.2);
      const y = d3.scaleLinear().domain([0, d3.max(dados, d => d[chave]) + 2]).range([height, 0]);

      g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format("d")));
      g.append("g").call(d3.axisLeft(y));

      g.selectAll("rect")
        .data(dados)
        .enter().append("rect")
        .attr("x", d => x(d.ano))
        .attr("y", y(0))
        .attr("width", x.bandwidth())
        .attr("height", 0)
        .attr("fill", cor)
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.ano}</strong><br>${label}: ${d[chave]}`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0))
        .transition().duration(1000).attr("y", d => y(d[chave])).attr("height", d => height - y(d[chave]));
    }

    function desenharGraficoVentoDirecao() {
      const svg = d3.select("#grafico-vento-direcao"),
        margin = { top: 20, right: 30, bottom: 30, left: 50 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      const x = d3.scaleBand().domain(direcoes.map(d => d.dir)).range([0, width]).padding(0.1);
      const y = d3.scaleLinear().domain([0, d3.max(direcoes, d => d.freq)]).range([height, 0]);

      g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x));
      g.append("g").call(d3.axisLeft(y));

      g.selectAll("rect")
        .data(direcoes)
        .enter().append("rect")
        .attr("x", d => x(d.dir))
        .attr("y", y(0))
        .attr("width", x.bandwidth())
        .attr("height", 0)
        .attr("fill", "steelblue")
        .on("mouseover", (event, d) => {
          tooltip.style("opacity", 1)
            .html(`<strong>${d.dir}</strong><br>Frequ√™ncia: ${d.freq}`)
            .style("left", `${event.pageX + 10}px`)
            .style("top", `${event.pageY - 28}px`);
        })
        .on("mouseout", () => tooltip.style("opacity", 0))
        .transition().duration(1000)
        .attr("y", d => y(d.freq))
        .attr("height", d => height - y(d.freq));
    }
  </script>
</body>

</html>